以下内容适用于zTC1 v1.0.2及以上版本

## 无安卓手机配置方法

此文档对无安卓手机无法直接通过app配置,打算接入hass等平台来控制的用户.

必须保证您有足够的技术能力,由于本人精力有限,请原谅无法提供关于此的技术支持.

最好你懂得udp通信方式,懂局域网.等内容. 对此类内容,不做多的描述.



此文实际上是整理通信协议,方便无法直接使用app的人快速配置.

## 开始

下文中.**发送**是指通过pc端或移动端发送udp数据. ip为排插的ip地址(可在路由器中查看).端口为10182.

**接收**是指pc端或移动端接收到排插发出的udp数据,监听的端口为10181.

你可以使用网络调试助手来发送/接收数据.



**文中mac地址为`1234567890ab`,请根据你的排插mac地址更换(请注意格式为全部小写无冒号)**



## 配对网络

自v1.0.0版本起,使用web配对,不需要任何其他命令.



## 激活

发送数据:

```
{
	"mac":"1234567890ab",
	"lock":"激活码字符串"			
}
```

激活码字符串为一串32个字符的字符串,注意不能包含任何空格等其他字符,否则一定无法激活成功.

为接受到排插的返回数据:

```
{
	"mac":"1234567890ab",
	"lock":"true或false"			
}
```

`true`表示激活成功,`false`表示激活失败.如果失败,请确认激活码是否正确.



## 设置mqtt服务器

发送数据:

```
{
	"mac":"1234567890ab",
	"setting":
	{
		"mqtt_uri":"www.mqtt.com",
		"mqtt_port":1883,
		"mqtt_user":"z",
		"mqtt_password":"123456"
	}
}
```

上文中`www.mqtt.com` \ `1883` \ `z` \ `123456`分别为mqtt地址,mqtt端口,mqtt用户,mqtt密码. 此处仅为举例,请对应**替换为自己的mqtt服务器**

接受数据:

```
{
	"mac":"1234567890ab",
	"setting":
	{
		"mqtt_uri":"www.mqtt.com",
		"mqtt_port":1883,
		"mqtt_user":"z",
		"mqtt_password":"123456"
	}
}
```

接收到的数据与发送数据相同即表示设置成功.



至此,一般配置已经完成. 之后就可以通过hass或其他Iot控制平台控制设备



## OTA

发送数据:

```
{
	"mac":"1234567890ab",
	"setting":
	{
		"ota":"http://192.168.43.119/TC1_MK3031_moc.ota.bin"
	}
}
```

上文中`http://192.168.43.119/TC1_MK3031_moc.ota.bin` 为ota的固件地址,地址中请勿包含`@`符号,请务必保证地址对应bin固件正确,否则可能会导致设备损坏!

接受数据:

```
{
	"mac":"1234567890ab",
	"setting":
	{
		"ota":"http://192.168.43.119/TC1_MK3031_moc.ota.bin"
	}
}
```

接收到的数据与发送数据相同即表示设备收到数据,设备开始ota,等待几分钟,如果成功,设备会自动重启,再获取版本号确认即可.









